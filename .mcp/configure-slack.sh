#!/bin/bash
# Script de configuration automatique du slash command Slack ALFA

TUNNEL_URL="https://aviation-audit-adjacent-alternative.trycloudflare.com"

echo "ğŸ”§ Configuration du slash command /alfa"
echo "================================================"
echo ""
echo "âœ… Tunnel Cloudflare actif:"
echo "   $TUNNEL_URL"
echo ""
echo "âš ï¸  ACTION MANUELLE REQUISE:"
echo ""
echo "1. Ouvrez dans votre navigateur:"
echo "   ğŸ‘‰ https://api.slack.com/apps/A0A73J9107P/slash-commands"
echo ""
echo "2. Cliquez sur 'Create New Command' (ou modifiez /alfa)"
echo ""
echo "3. Remplissez avec ces valeurs:"
echo "   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "   Command:          /alfa"
echo "   Request URL:      ${TUNNEL_URL}/slack/command"
echo "   Short Desc.:      Execute ALFA MCP tools"
echo "   Usage Hint:       status | grafana | slack_send_message"
echo "   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "4. âœ… Cochez: 'Escape channels, users, and links'"
echo ""
echo "5. Cliquez 'Save'"
echo ""
echo "6. Testez dans Slack #bct:"
echo "   /alfa status"
echo ""
echo "================================================"
echo ""

# Test du webhook
echo "ğŸ§ª Test du webhook local..."
curl -s http://localhost:3333/health && echo "âœ… Webhook server: OK" || echo "âŒ Webhook server: ERROR"

echo ""
echo "ğŸ§ª Test du tunnel Cloudflare..."
curl -s ${TUNNEL_URL}/health && echo "âœ… Tunnel Cloudflare: OK" || echo "âŒ Tunnel Cloudflare: ERROR"

echo ""
echo "================================================"
echo "ğŸ“‹ COPIER-COLLER pour la configuration:"
echo "================================================"
echo ""
echo "Request URL:"
echo "${TUNNEL_URL}/slack/command"
echo ""
echo "================================================"
echo ""
echo "ğŸ’¡ Le tunnel reste actif tant que cloudflared tourne"
echo "ğŸ’¡ Le webhook server reste actif tant que node slack-webhook.js tourne"
echo ""
echo "Pour arrÃªter:"
echo "  - Ctrl+C dans le terminal du webhook"
echo "  - Ctrl+C dans le terminal cloudflared"
echo ""
